<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .calculator-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .result-box {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
        }
        .nav-tabs {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="calculator-container">
            <h2 class="text-center mb-4">Real Estate Calculator</h2>
            
            <ul class="nav nav-tabs" id="calculatorTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="seller-tab" data-bs-toggle="tab" href="#seller" role="tab">
                        Seller Financing
                    </a>
                </li>
                <!-- Add more tabs as needed -->
            </ul>
            
            <div class="tab-content" id="calculatorTabContent">
                <div class="tab-pane fade show active" id="seller" role="tabpanel">
                    <form id="sellerFinancingForm" class="mt-3">
                        <div class="mb-3">
                            <label for="salePrice" class="form-label">Sale Price ($)</label>
                            <input type="number" class="form-control" id="salePrice" required>
                        </div>
                        <div class="mb-3">
                            <label for="downPayment" class="form-label">Down Payment ($)</label>
                            <input type="number" class="form-control" id="downPayment" required>
                        </div>
                        <div class="mb-3">
                            <label for="interestRate" class="form-label">Interest Rate (%)</label>
                            <input type="number" class="form-control" id="interestRate" step="0.1" required>
                        </div>
                        <div class="mb-3">
                            <label for="loanTerm" class="form-label">Loan Term (Years)</label>
                            <input type="number" class="form-control" id="loanTerm" value="30" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Calculate</button>
                        <button type="button" class="btn btn-secondary" onclick="saveScenario()">Save Scenario</button>
                    </form>
                    
                    <div id="results" class="result-box mt-4" style="display: none;">
                        <h4>Results</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <p>Monthly Payment: <span id="monthlyPayment"></span></p>
                                <p>Loan Amount: <span id="loanAmount"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p>Total Payments: <span id="totalPayments"></span></p>
                                <p>Total Interest: <span id="totalInterest"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Scenarios Section -->
            <div class="mt-4">
                <h4>Saved Scenarios</h4>
                <div id="scenariosList" class="list-group">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('sellerFinancingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateSellerFinancing();
        });

        function calculateSellerFinancing() {
            const data = {
                type: 'seller_financing',
                sale_price: document.getElementById('salePrice').value,
                down_payment: document.getElementById('downPayment').value,
                rate: document.getElementById('interestRate').value,
                years: document.getElementById('loanTerm').value
            };

            fetch('/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('results').style.display = 'block';
                document.getElementById('monthlyPayment').textContent = formatCurrency(data.monthly_payment);
                document.getElementById('loanAmount').textContent = formatCurrency(data.loan_amount);
                document.getElementById('totalPayments').textContent = formatCurrency(data.total_payments);
                document.getElementById('totalInterest').textContent = formatCurrency(data.total_interest);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error calculating results');
            });
        }

        function saveScenario() {
            const name = prompt('Enter a name for this scenario:');
            if (!name) return;

            const data = {
                name: name,
                data: {
                    sale_price: document.getElementById('salePrice').value,
                    down_payment: document.getElementById('downPayment').value,
                    rate: document.getElementById('interestRate').value,
                    years: document.getElementById('loanTerm').value
                }
            };

            fetch('/save_scenario', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Scenario saved successfully!');
                    loadScenarios();
                } else {
                    alert('Error saving scenario: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving scenario');
            });
        }

        function loadScenarios() {
            fetch('/scenarios')
                .then(response => response.json())
                .then(scenarios => {
                    const scenariosList = document.getElementById('scenariosList');
                    scenariosList.innerHTML = '';
                    
                    Object.entries(scenarios).forEach(([id, scenario]) => {
                        const item = document.createElement('a');
                        item.href = '#';
                        item.className = 'list-group-item list-group-item-action';
                        item.textContent = `${scenario.name} (${new Date(scenario.created_at).toLocaleDateString()})`;
                        item.onclick = () => loadScenario(scenario.data);
                        scenariosList.appendChild(item);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function loadScenario(data) {
            document.getElementById('salePrice').value = data.sale_price;
            document.getElementById('downPayment').value = data.down_payment;
            document.getElementById('interestRate').value = data.rate;
            document.getElementById('loanTerm').value = data.years;
            calculateSellerFinancing();
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(value);
        }

        // Load scenarios when page loads
        loadScenarios();
    </script>
</body>
</html> 